apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
metadata:
  name: project2-front

resources:
  - ../../../base/
  - ingress_Frontend_With-allow-list.yaml

namespace: project2ns

nameSuffix: -frontend-3333

patches:
  # Json 6902 patch format
  # https://datatracker.ietf.org/doc/html/rfv6902
  - target:
      kind: Deployment
      name: dpl

    patch: |-
      #- op: replace
      #  path: /metadata/name
      #  value: depl-frontend-3333
      - op: replace
        path: /metadata/labels/appname
        value: app-frontend-3333
      - op: replace
        path: /spec/selector/matchLabels/app
        value: pod-frontend-3333
      - op: replace
        path: /spec/template/metadata/labels/app
        value: pod-frontend-3333
      - op: replace
        path: /spec/template/metadata/labels/netzone
        value: frontend
      - op: replace
        path: /spec/template/spec/containers/0/name
        value: cnt-frontend-3333
      - op: replace
        path: /spec/template/spec/containers/0/ports/0
        value:
          containerPort: 3333
      - op: replace
        path: /spec/template/spec/containers/0/command/1
        value: "3333"

  - target:
      kind: Service
      name: svc

    patch: |-
      #- op: replace
      #  path: /metadata/name
      #  value: svc-frontend-3333
      - op: replace
        path: /spec/selector/app
        value: pod-frontend-3333
      - op: replace
        path: /spec/ports/0
        value:
          port: 3333
          targetPort: 3333
      
  - target:
      kind: Ingress
      name: ingress-ipfilter

    patch: |-
      #- op: replace
      #  path: /metadata/name
      #  value: ingress-ipfilter-frontend-3333
      - op: replace
        path: /spec/rules/0/http/paths/0/path
        value: /frontend-3333
      - op: replace
        path: /spec/rules/0/http/paths/0/backend/service/name
        value: svc-frontend-3333
      - op: replace
        path: /spec/rules/0/http/paths/0/backend/service/port/number
        value: 3333

 # Strategic merge patch format
  #- patch: |-
  #    apiVersion: apps/v1
  #    kind: Deployment
  #    metadata:
  #      name: frontendpod-
  #    spec:
